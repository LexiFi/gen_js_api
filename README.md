gen_js_api: generate OCaml bindings for Javascript libraries
============================================================

Overview
--------

gen_js_api aims at simplifying the creation of OCaml bindings for
Javascript libraries, to be used with the [js_of_ocaml
compiler](https://github.com/ocsigen/js_of_ocaml).  It is based on the
following ideas:

 - Authors of bindings write OCaml signatures for Javascript libraries
   and the tool generates automatically the actual binding code.

 - The generated binding code takes care of translating values between
   OCaml and Javascript.

 - The client code looks like normal OCaml code and does not depend on
   custom syntax nor on JS-specific types (unless desired).


gen_js_api supports can be used in two (completementary) ways:

  - [Generating .ml implementations from annotated .mli interfaces](IMPLGEN.md),
    in order to create the code for stub libraries.

  - As a [ppx preprocessor on implementations](PPX.md) to define local
    bindings.


Installation (with OPAM)
------------------------

gen_js_api currently relies on the trunk version of OCaml and the development
version of js_of_ocaml (and since this development version doesn't install,
I suggest to use a fork as below):

   ```
   opam switch 4.03.0+trunk
   opam pin add js_of_ocaml git@github.com:alainfrisch/js_of_ocaml.git
   opam pin add gen_js_api git@github.com:alainfrisch/gen_js_api.git
   ```



Usage (with ocamlfind)
----------------------

 - Invoking the [standalone tool](IMPLGEN.md) (`.mli` -> `.ml` generator):

   ```
   ocamlfind gen_js_api/gen_js_api my_unit.mli
   ```

 - Compiling binding (`.mli` and generated `.ml` files) and user
   code which rely on the `Ojs` module:

   ```
   ocamlfind ocamlc -package gen_js_api my_unit.mli
   ocamlfind ocamlc -package gen_js_api my_unit.ml
   ```

 - Compiling with the [ppx processor](PPX.md):

   ```
   ocamlfind ocamlc -c -package gen_js_api.ppx my_prog.ml
   ```

 - Linking the bytecode program:

   ```
   ocamlfind ocamlc -o my_prog -no-check-prims -package gen_js_api -linkpkg ...
   ```

 - Compiling into Javascript:

   ```
   js_of_ocaml -o my_prog.js +gen_js_api/ojs_runtime.js my_prog
   ```

Examples
--------

The repository contains some examples of OCaml bindings to Javascript
libraries created with gen_js_api:

 - Very partial [ bindings to jQuery](examples/jquery.mli), with
   some [example client code](examples/test_jquery.ml).

 - Very partial [bindings to Javascript strings and
   regexps](examples/js_str.mli), with some [example client
   code](examples/test_js_str.ml).


Low-level binding to Javascript
-------------------------------

The code generated by gen_js_api relies on a `Ojs` module (the runtime
support library).  This modules defines in particular a type `Ojs.t`
which corresponds roughly to js_of_ocaml's `Js.Unsafe.any` type --
that is, an opaque type that represents arbitrary JS values -- but
with associated operations that abstract away from specific properties
of how js_of_ocaml represents OCaml values (for instance the fact that
OCaml integers are encoded directly as JS numbers).  This would make
it easy to change the way OCaml and JS are connected (either because
of changes in js_of_ocaml's encoding of OCaml values, or because an
entirely different technology is used, such as an OCaml bytecode
interpreter written in Javascript or a Javascript engine linked with
native OCaml code).

Note that code generated by gen_js_api doesn't depend on js_of_ocaml's
standard library (`Js` module), only on js_of_ocaml's runtime system.
Our local `Ojs` interface maps directly to primitive provided by
js_of_ocaml's runtime.



Name conversion
---------------

Javascript names corresponding to bound components can always be
specified explicitly (with the use of attributes).  When the naming is
left implicit, a Javascript name is automatically derived from the
OCaml name by applying the following rules:

  - uppercasing every character following an underscore;

  - removing every underscore;

  - uppercasing the first character when generating object constructor names.


Documentation
-------------

  - [Using gen_js_api to generate .ml from .mli](IMPLGEN.md)
  - [Using gen_js_api as a ppx processor](PPX.md)
  - [JS-able types and type declarations](TYPES.md)
  - [Value bindings](VALUES.md)
  - [Class-wrapping bindings](CLASSES.md)
  - [TODO list] (TODO.md)


Related projects
----------------

  - [js_of_ocaml](https://github.com/ocsigen/js_of_ocaml): The compiler
    and runtime system on which gen_js_api relies. (Note: gen_js_api
    doesn't depend on js_of_ocaml's OCaml library, nor on its syntax
    extension.)

  - [goji](https://github.com/klakplok/goji): A DSL to describe OCaml
    bindings for JavaScript libraries.

  - [DefinitelyMaybeTyped](https://github.com/andrewray/DefinitelyMaybeTyped):
    A project to parse
    [DefinitelyTyped](https://github.com/borisyankov/DefinitelyTyped)
    interfaces and produce OCaml interfaces.


About
-----

This package is licensed by LexiFi under the terms of the MIT license.

Contact: alain.frisch@lexifi.com

Contributors:

 - Alain Frisch
 - Sebastien Briais


Currenlty, this package works only on OCaml trunk, not on any released
version.  The package is itself not released.

